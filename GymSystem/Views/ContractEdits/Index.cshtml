@model IEnumerable<DataModel.ContractEdit>
@using DataModel
@{
    ViewData["Title"] = "合約異動紀錄";
    var extendList = Model.Where(x => x.EditType == EditType.延展結束日期).OrderByDescending(x => x.EditDate).ToList();
    var addClassList = Model.Where(x => x.EditType == EditType.增加課堂數).OrderByDescending(x => x.EditDate).ToList();
    var transferList = Model.Where(x => x.EditType == EditType.轉讓課堂).OrderByDescending(x => x.EditDate).ToList();

}
<div class="card shadow-sm mb-4" style="border-radius: 12px;">
    <div class="card-body d-flex justify-content-between align-items-center p-3">
        <div>
            <h5 class="mb-2"><i class="bi bi-file-earmark-text me-2 text-success"></i> 合約基本資料</h5>
            <div class="mb-1"><strong>簽約人：</strong>@ViewData["signer"]</div>
            <div class="mb-1"><strong>課程名稱：</strong>@ViewData["className"]</div>
        </div>
        <div>
            <a asp-action="Details" asp-controller="Contracts" asp-route-id="@ViewData["contractId"]" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left me-1"></i> 回合約
            </a>
        </div>
    </div>
</div>

<div class="card shadow-sm mb-4" style="border-radius: 12px;">
    <div class="card-header bg-light" style="border-top-left-radius: 12px; border-top-right-radius: 12px; cursor:pointer;"
         data-bs-toggle="collapse" data-bs-target="#collapseExtend" aria-expanded="@extendList.Any()" aria-controls="collapseExtend">
        <h4 class="mb-0">
            <i class="bi bi-pencil-square me-2 text-info"></i> 延展結束日期
            <span class="float-end"><i class="bi bi-chevron-down"></i></span>
        </h4>
    </div>
    <div id="collapseExtend" class="collapse @(extendList.Any() ? "show" : "")">
        <div class="card-body p-4">
            <div class="table-responsive">
                <table class="table table-bordered table-hover align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>異動日期</th>
                            <th>新結束日期</th>
                            <th>承辦人</th>
                            <th>備註</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (!extendList.Any())
                        {
                            <tr><td colspan="5" class="text-center text-muted">查無資料</td></tr>
                        }
                        else
                        {
                            foreach (var item in extendList)
                            {
                                <tr>
                                    <td>@item.EditDate.ToString("yyyy-MM-dd")</td>
                                    <td>@(item.NewEndDate?.ToString("yyyy-MM-dd") ?? "-")</td>
                                    <td>@item.Handler?.MemberName</td>
                                    <td>@item.Remarks</td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="card shadow-sm mb-4" style="border-radius: 12px;">
    <div class="card-header bg-light" style="border-top-left-radius: 12px; border-top-right-radius: 12px; cursor:pointer;"
         data-bs-toggle="collapse" data-bs-target="#collapseAddClass" aria-expanded="@addClassList.Any()" aria-controls="collapseAddClass">
        <h4 class="mb-0">
            <i class="bi bi-plus-circle me-2 text-success"></i> 增加課堂數
            <span class="float-end"><i class="bi bi-chevron-down"></i></span>
        </h4>
    </div>
    <div id="collapseAddClass" class="collapse @(addClassList.Any() ? "show" : "")">
        <div class="card-body p-4">
            <div class="table-responsive">
                <table class="table table-bordered table-hover align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>異動日期</th>
                            <th>加購堂數</th>
                            <th>承辦人</th>
                            <th>備註</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (!addClassList.Any())
                        {
                            <tr><td colspan="5" class="text-center text-muted">查無資料</td></tr>
                        }
                        else
                        {
                            foreach (var item in addClassList)
                            {
                                <tr>
                                    <td>@item.EditDate.ToString("yyyy-MM-dd")</td>
                                    <td>@item.AddClassCount</td>
                                    <td>@item.Handler?.MemberName</td>
                                    <td>@item.Remarks</td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="card shadow-sm mb-4" style="border-radius: 12px;">
    <div class="card-header bg-light" style="border-top-left-radius: 12px; border-top-right-radius: 12px; cursor:pointer;"
         data-bs-toggle="collapse" data-bs-target="#collapseTransfer" aria-expanded="@transferList.Any()" aria-controls="collapseTransfer">
        <h4 class="mb-0">
            <i class="bi bi-arrow-left-right me-2 text-warning"></i> 轉讓課堂
            <span class="float-end"><i class="bi bi-chevron-down"></i></span>
        </h4>
    </div>
    <div id="collapseTransfer" class="collapse @(transferList.Any() ? "show" : "")">
        <div class="card-body p-4">
            <div class="table-responsive">
                <table class="table table-bordered table-hover align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>異動日期</th>
                            <th>轉讓對象</th>
                            <th>轉讓堂數</th>
                            <th>承辦人</th>
                            <th>備註</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (!transferList.Any())
                        {
                            <tr><td colspan="6" class="text-center text-muted">查無資料</td></tr>
                        }
                        else
                        {
                            foreach (var item in transferList)
                            {
                                <tr>
                                    <td>@item.EditDate.ToString("yyyy-MM-dd")</td>
                                    <td>@item.TransferToMemberID</td>
                                    <td>@item.TransferClassCount</td>
                                    <td>@item.Handler?.MemberName</td>
                                    <td>@item.Remarks</td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>